import React, { useMemo, Suspense } from 'react'
import { HashRouter as Router } from 'react-router-dom'
import { Provider } from 'react-redux'
import zoro from '@opcjs/zoro'
import { createLoading } from '@opcjs/zoro-plugin'
import Routes from '@/routes'
import { zoro as config } from '@/app'
import Loading from '@/components/loading/loading'
import Layout from '@/layouts'

const app = zoro(config)
<% if (models.length) { -%>
  <% models.forEach(function(model) { -%>
    app.model(require('<%= model %>').default),
  <% }) -%>
<% } -%>
app.use(createLoading())
<% if (plugins.length) { -%>
  <% plugins.forEach(function(plugin) { -%>
    app.use(require('<%= plugin %>').default),
  <% }) -%>
<% } -%>
const store = app.start()

window._APP_ = app
window._STORE_ = store

export default function App() {
  return useMemo(() => {
    return (
      <Provider store={store}>
        <Layout>
          <Router>
            <Suspense fallback={<Loading />}>
              <Routes />
            </Suspense>
          </Router>
        </Layout>
      </Provider>
    )
  }, [])
}